<ng-container *ngIf="isRouted; else modalTpl">
  <div class="p-4 max-w-xl">
    <div class="flex justify-between items-start">
      <h3 class="text-xl font-semibold">Alumno <span *ngIf="!loading && alumnoId"
          class="badge badge-info">{{ alumnoId }}</span></h3>
      <button class="btn btn-ghost" (click)="close()">Cerrar</button>
    </div>

    <div *ngIf="loading" class="mt-4">Cargando...</div>

    <div *ngIf="!loading && alumno" class="mt-4 space-y-3">
      <div><strong>Nombre:</strong> {{ alumno.persona.nombres || '—' }} {{ alumno.persona.apellidos || '' }}</div>
      <div><strong>DNI:</strong> {{ alumno.persona.documentoIdentidad || '—' }}</div>
      <div><strong>Género:</strong> {{ alumno.persona.sexo || '—' }}</div>
      <div><strong>Fecha Nacimiento:</strong>
        {{ alumno.persona.fechaNacimiento ? (alumno.persona.fechaNacimiento | date) : '—' }}</div>
      <div><strong>Contacto:</strong> {{ alumno.persona.numeroTelefono || '—' }}</div>
      <div><strong>Email:</strong> {{ alumno.persona.email || '—' }}</div>
      <div *ngIf="alumno.matriculaActual" class="pt-2 border-t">
        <strong>Matricula:</strong>
        <div class="ml-2">
          <div>Nivel: {{ alumno.matriculaActual.nivel.nivelDescripcion || '—' }}</div>
          <div>Grado: {{ alumno.matriculaActual.nivel.gradoDescripcion || '—' }}</div>
          <div>Sección: {{ alumno.matriculaActual.nivel.seccionDescripcion || '—' }}</div>
        </div>
      </div>
      <div *ngIf="alumno.tutor" class="pt-2 border-t">
        <strong>Apoderado / Tutor:</strong>
        <div class="ml-2">{{ alumno.tutor.nombres }} {{ alumno.tutor.apellidos }} — {{ alumno.tutor.email || '—' }}
        </div>
      </div>
    </div>

    <div *ngIf="!loading && !alumno" class="mt-4 text-sm text-gray-500">No se encontró el alumno.</div>
  </div>
</ng-container>

<ng-template #modalTpl>
  <div *ngIf="open" class="fixed inset-0 z-50 flex items-center justify-center">
    <div class="fixed inset-0 bg-black/40" (click)="close()" aria-hidden="true"></div>
    <!-- Modal container: fixed, centered, animated by Angular -->
    <div @fadeIn
      class="fixed z-10 w-full max-w-2xl p-4 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-base-100 rounded-lg shadow-lg transition-transform transition-opacity duration-150 ease-out">
      <div class="flex justify-between items-start">
        <h3 class="text-xl font-semibold">Alumno</h3>
        <button class="btn btn-ghost" (click)="close()">Cerrar</button>
      </div>

      <div *ngIf="loading" class="mt-4">Cargando...</div>

      <div *ngIf="!loading && alumno" class="mt-4 space-y-3">
        <div><strong>Nombre:</strong> {{ alumno.persona.nombres }} {{ alumno.persona.apellidos }}</div>
        <div><strong>DNI:</strong> {{ alumno.persona.documentoIdentidad || '—' }}</div>
        <div><strong>Género:</strong> {{ alumno.persona.sexo || '—' }}</div>
        <div><strong>Fecha Nacimiento:</strong> {{ alumno.persona.fechaNacimiento | date }}</div>
        <div><strong>Contacto:</strong> {{ alumno.persona.numeroTelefono || '—' }}</div>
        <div><strong>Email:</strong> {{ alumno.persona.email || '—' }}</div>
        <div *ngIf="alumno.matriculaActual" class="pt-2 border-t">
          <strong>Matricula:</strong>
          <div class="ml-2">
            <div>Nivel: {{ alumno.matriculaActual.nivel.nivelDescripcion || '—' }}</div>
            <div>Grado: {{ alumno.matriculaActual.nivel.gradoDescripcion || '—' }}</div>
            <div>Sección: {{ alumno.matriculaActual.nivel.seccionDescripcion || '—' }}</div>
          </div>
        </div>
        <div *ngIf="alumno.tutor" class="pt-2 border-t">
          <strong>Apoderado / Tutor:</strong>
          <div class="ml-2">{{ alumno.tutor.nombres }} {{ alumno.tutor.apellidos }} — {{ alumno.tutor.email || '—' }}
          </div>
        </div>
      </div>

      <div *ngIf="!loading && !alumno" class="mt-4 text-sm text-gray-500">No se encontró el alumno.</div>
    </div>
  </div>
</ng-template>
