<div class="mb-4 flex items-center gap-2">
  <ng-container *ngIf="showSearch">
    <ng-container *ngIf="searchControl; else internalSearch">
      <input [formControl]="searchControl" class="input max-w-sm" [placeholder]="searchPlaceholder" />
    </ng-container>
    <ng-template #internalSearch>
      <input class="input max-w-sm" [placeholder]="searchPlaceholder" [(ngModel)]="search"
        (ngModelChange)="onSearchInput($event)" />
    </ng-template>
  </ng-container>
  <button *ngIf="newLabel" class="btn" (click)="create.emit()">{{ newLabel }}</button>
  <button class="btn" type="button"
    (click)="toggleFilters()">{{ showFilters ? 'Ocultar filtros' : 'Mostrar filtros' }}</button>
  <button class="btn" type="button" (click)="resetFiltersAndSort()">Reiniciar Filtros y Ordenamientos</button>
</div>

<div class="card overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50 text-xs uppercase text-gray-600">
      <tr>
        <th *ngFor="let col of columns" class="px-4 py-3 text-left">
          <button class="flex items-center gap-1" type="button" (click)="toggleSort(col.key)">
            <span>{{ col.label }}</span>
            <span *ngIf="sortKey === col.key">
              <span *ngIf="sortDir === 'asc'">▲</span>
              <span *ngIf="sortDir === 'desc'">▼</span>
            </span>
          </button>
        </th>
        <th class="px-4 py-3 text-left">Activo</th>
        <th class="px-4 py-3 text-left">Acciones</th>
      </tr>
      <tr *ngIf="enableFilters && showFilters" class="bg-gray-100 text-xs text-gray-500">
        <th *ngFor="let col of columns" class="px-4 py-2">
          <input class="input input-xs w-full" [value]="filters[col.key]"
            (input)="onFilterChange(col.key, $any($event.target).value)" placeholder="Filtrar {{ col.label }}" />
        </th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100 bg-white text-gray-800">
      <tr *ngFor="let item of displayItems">
        <td *ngFor="let col of columns" class="px-4 py-3">
          <ng-container *ngIf="getTemplate(col.key) as tmpl; else defaultCell">
            <ng-container *ngTemplateOutlet="tmpl; context: { $implicit: item, item: item }"></ng-container>
          </ng-container>
          <ng-template #defaultCell>
            <ng-container [ngSwitch]="col.key">
              <ng-container
                *ngSwitchCase="'fullName'">{{ (item?.nombres || '') + ' ' + (item?.apellidos || '') }}</ng-container>
              <ng-container *ngSwitchDefault>{{ item?.[col.key] ?? '—' }}</ng-container>
            </ng-container>
          </ng-template>
        </td>
        <td class="px-4 py-3">
          <span class="inline-flex items-center gap-2 rounded-full px-2.5 py-1 text-xs"
            [class.bg-green-100]="item.activo" [class.text-green-800]="item.activo" [class.bg-gray-100]="!item.activo"
            [class.text-gray-700]="!item.activo">
            <span class="h-2 w-2 rounded-full" [class.bg-green-500]="item.activo"
              [class.bg-gray-400]="!item.activo"></span>
            {{ item.activo ? 'Sí' : 'No' }}
          </span>
        </td>
        <td class="px-4 py-3">
          <div class="flex items-center gap-2">
            <button *ngIf="viewLinkKey" type="button" class="btn btn-sm btn-ghost" (click)="onView(item)">Ver</button>
            <button class="btn btn-sm btn-outline" (click)="edit.emit(item)">Editar</button>
            <button class="btn btn-sm"
              (click)="toggleActive.emit(item)">{{ item.activo ? 'Desactivar' : 'Activar' }}</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="mt-3 flex items-center gap-2">
  <button class="btn-outline" (click)="prev.emit()" [disabled]="page <= 1">Anterior</button>
  <span class="text-sm text-gray-600">Página {{ page }} / {{ totalPages }}</span>
  <button class="btn-outline" (click)="next.emit()" [disabled]="page >= totalPages">Siguiente</button>
</div>
